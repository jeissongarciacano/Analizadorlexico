<html>
<body>
<form name=FormularioDatos>
	<input type=text name=CadenaIngresada>
	<input type=button value="Analizar >>>" onclick="AnalizarCadena();"> <input type=button value='Reiniciar' onclick='location.reload(true)'><br>
	<textarea name=salida rows=25 cols=80></textarea>
</form>
<script language="JavaScript">
var PosicionCinta = 0;
var DetectadoErrorSintaxis = 0;
var TokenEntrada = '';
var CadenaAnalizada = '';

function LlevarLog(mensaje)
	 {
		console.log("Para "+TokenEntrada+" "+mensaje);
	 }

function PresentarMensaje(mensaje)
	 {
		document.FormularioDatos.salida.value+=mensaje+"\n";
	 }

function PresentarError(complemento)
	 {
		if (typeof(TokenEntrada) !== 'undefined')
			{
				PresentarMensaje("ERROR en token: "+TokenEntrada+" "+complemento);
			}
	 }

function Expresion()
	{
		LlevarLog("Expresion");
		Termino();
		ExpresionPrima();
	}

function ExpresionPrima()
	{
		if (typeof(TokenEntrada) !== 'undefined')
			{
				LlevarLog("ExpresionPrima");
				if (TokenEntrada=='+')
					{
						HacerMatch('+');
						Termino();
						ExpresionPrima();
					}
				else
					{
						if (TokenEntrada=='-')
							{
								HacerMatch('-');
								Termino();
								ExpresionPrima();
							}
						else
							{
								PresentarError("ERROR en token: "+TokenEntrada+" ");
								//No hacer nada: Epsilon
							}
					}
			}	
	}

function Termino()
	{
		LlevarLog("Termino");
		Factor();
		TerminoPrima();
	}

function TerminoPrima()
	{
		if (typeof(TokenEntrada) !== 'undefined')
			{
				LlevarLog("TerminoPrima");
				if (TokenEntrada=='*')
					{
						HacerMatch('*');
						Factor();
						TerminoPrima();
					}
				else
					{
						if (TokenEntrada=='/')
							{
								HacerMatch('/');
								Factor();
								TerminoPrima();
							}
						else
							{
								//No hacer nada: Epsilon
							}
					}
			}		
	}

function Factor()
	{
		if (typeof(TokenEntrada) !== 'undefined')
			{
				LlevarLog("Factor");
				if (!isNaN(TokenEntrada))
					{
						Numero();
					}
			}
	}
	
function HacerMatch(t)
	{
		if (typeof(TokenEntrada) !== 'undefined')
			{
				if (t != TokenEntrada)
					{
						PresentarError("Se esperaba "+t);
					}
				else
					{
						TokenEntrada = ObtenerToken();
					}
			}
	}

function Numero()
	{
		LlevarLog("Numero");
		Digito();
		NumeroPrima();
	}

function NumeroPrima()
	{
		if (typeof(TokenEntrada) !== 'undefined')
			{
				LlevarLog("NumeroPrima");
				if (!isNaN(TokenEntrada))
					{
						Digito();
						NumeroPrima();
					}
				else
					{
						//No hacer nada: Epsilon
					}
			}
	}

function Digito()
	{
		if (typeof(TokenEntrada) !== 'undefined')
			{
				LlevarLog("Digito");
				if (!isNaN(TokenEntrada))
					{
						HacerMatch(TokenEntrada);
					}
				else
					{
						PresentarError("Se esperaba un digito");
					}
			}
	}

function ObtenerToken()
	{
		if (typeof(CadenaAnalizada[PosicionCinta - 1]) !== 'undefined')
			PresentarMensaje("Analizando token: "+CadenaAnalizada[PosicionCinta - 1]);
		if(PosicionCinta>0){
			if(PosicionCinta==CadenaAnalizada.length-1 && (CadenaAnalizada[PosicionCinta]== '/'|| CadenaAnalizada[PosicionCinta]== '*'|| CadenaAnalizada[PosicionCinta]== '+'|| CadenaAnalizada[PosicionCinta]== '-')){
				PresentarError(CadenaAnalizada[PosicionCinta]);
				return;
			}
			else if(CadenaAnalizada[PosicionCinta-1]== '/'|| CadenaAnalizada[PosicionCinta-1]== '*'|| CadenaAnalizada[PosicionCinta-1]== '+'|| CadenaAnalizada[PosicionCinta-1]== '-' ){
				if(CadenaAnalizada[PosicionCinta]== '/'|| CadenaAnalizada[PosicionCinta]== '*'|| CadenaAnalizada[PosicionCinta]== '+'|| CadenaAnalizada[PosicionCinta]== '-'){
					PresentarError(CadenaAnalizada[PosicionCinta]);
					return;
				}
			}
		}
		else if(PosicionCinta==0 && (CadenaAnalizada[PosicionCinta]== '/'|| CadenaAnalizada[PosicionCinta]== '*'|| CadenaAnalizada[PosicionCinta]== '+'|| CadenaAnalizada[PosicionCinta]== '-')){
			PresentarError(CadenaAnalizada[PosicionCinta]);
			return;
		}

		PosicionCinta = PosicionCinta + 1
		return (CadenaAnalizada[PosicionCinta - 1])
	}

function AnalizarCadena()
	{
		PosicionCinta = 0;
		CadenaAnalizada = document.FormularioDatos.CadenaIngresada.value;
		document.FormularioDatos.salida.value="";
		PresentarMensaje("Verificando sintaxis para: "+CadenaAnalizada+"\n---------------------------------------------------------------");
		TokenEntrada = ObtenerToken();
		Expresion();
		//MANEJADOR DE ERRORES (inicialmente para numeros)
		//Cuando termina si hubo error hace otras pasadas
		while (DetectadoErrorSintaxis==1)
			{
			DetectadoErrorSintaxis = 0;
			PosicionCinta+=2;
			TokenEntrada = ObtenerToken();
			Expresion();
			}

		//Opcion para regresar a la evaluacion
	}
</script>
</body>
</html>
